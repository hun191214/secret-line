import { NextResponse } from 'next/server';
import { cookies } from 'next/headers';

/**
 * 현재 로그인 세션 확인
 */
export async function GET() {
  try {
    const cookieStore = await cookies();
    const sessionCookie = cookieStore.get('auth_session');

    if (!sessionCookie) {
      return NextResponse.json({
        success: false,
        authenticated: false,
      });
    }

    try {
      const session = JSON.parse(sessionCookie.value);
      return NextResponse.json({
        success: true,
        authenticated: true,
        user: {
          email: session.email,
          role: session.role,
          userId: session.userId,
          coins: session.coins || 0,
          counselorStatus: session.counselorStatus || 'offline',
        },
      });
    } catch {
      // 쿠키 파싱 실패 시 로그아웃 처리
      cookieStore.delete('auth_session');
      return NextResponse.json({
        success: false,
        authenticated: false,
      });
    }
  } catch (error) {
    return NextResponse.json({
      success: false,
      authenticated: false,
    });
  }
}

